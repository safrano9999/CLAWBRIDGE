# ğŸ¦ CLAWBRIDGE

A minimal, rootless job dispatcher triggered by filesystem events.  
Built for [OpenClaw](https://openclaw.dev) â€“ but works with any unprivileged service user.  
No sudo. No polling. Just files.

---

## ğŸ’¡ What is this and why does it exist?

This setup is based on a deliberate security decision: running OpenClaw under its own dedicated system user `openclaw`, sharing only specific designated folders where needed. Each user stays in its own lane.

But here's the problem: what if OpenClaw needs to trigger something that belongs to your main user? Like sorting your emails, running a backup, or executing a personal script? You can't just let `openclaw` run those â€” it has no access, and giving it access would defeat the entire point.

**CLAWBRIDGE solves this with a dead-simple idea:**

> `openclaw` drops a file into a shared folder. That's it. That's the only thing it's allowed to do.

Your main user's service watches that folder. The moment a file appears, it picks it up, runs the right script, and cleans up. `openclaw` drops a file â€” that is the only thing CLAWBRIDGE is responsible for. What else is configured between the two users is up to you.

This keeps OpenClaw fully isolated while still letting it trigger actions on your behalf â€” without sudo, without shared passwords, without open ports.

---

## ğŸ”’ Security Model

CLAWBRIDGE runs as a regular user service via systemd.  
The only shared surface between OpenClaw and the dispatcher is a single directory: `TRIGGERDIR/`.

- OpenClaw gets write access to `TRIGGERDIR/` â€“ dropping a file there triggers jobs on the main user's side
- Job scripts run in the main user's context
- inotify is a Linux kernel mechanism â€“ no polling process, no CPU load at idle

```
ğŸ¦ openclaw
    â”‚
    â”‚  touch TRIGGERDIR/A
    â–¼
ğŸ“¬ TRIGGERDIR/           â† only shared surface (write-only for openclaw)
    â–²
    â”‚  kernel notifies instantly via inotify
    â–¼
âš™ï¸  clawbridge.sh         â† runs as owner, reads config, executes jobs
```

---

## ğŸ“ Structure

```
clawbridge/
â”œâ”€â”€ clawbridge.sh       â† dispatcher (systemd user service)
â”œâ”€â”€ clawbridge.yaml     â† job registry
â”œâ”€â”€ clawbridge.service  â† systemd user unit
â”œâ”€â”€ TRIGGERDIR/         â† trigger files land here
â”œâ”€â”€ SCRIPTS/
â”‚   â””â”€â”€ A_example.sh   â† smoke test
â””â”€â”€ logs/
    â”œâ”€â”€ CLAWBRIDGE.log
    â””â”€â”€ DROP.log
```

---

## ğŸš€ Setup

### 1. Dependencies

```bash
sudo apt install inotify-tools github-cli
```

### 2. Permissions

```bash
chmod +x clawbridge.sh SCRIPTS/*.sh
```

### 3. Service

```bash
mkdir -p ~/.config/systemd/user
ln -s "$(realpath clawbridge.service)" ~/.config/systemd/user/clawbridge.service
systemctl --user daemon-reload
systemctl --user enable --now clawbridge
```

To keep the service running without an active login session:

```bash
sudo loginctl enable-linger $USER
```

### 4. TRIGGERDIR permissions

âš ï¸ Give OpenClaw write access to `TRIGGERDIR/`:

```bash
sudo chown $USER:openclaw TRIGGERDIR
sudo chmod 1770 TRIGGERDIR
```

---

## ğŸ“‹ Job Modes

| Mode | Behavior |
|------|----------|
| `instant` | âš¡ inotify fires immediately when trigger file appears |
| `cron` | ğŸ‘» ignored by CLAWBRIDGE â€“ the cron script handles it itself, no `script` needed |

Script paths in yaml support: `./relative`, `$HOME/...`, or absolute.

After editing `clawbridge.yaml`:

```bash
systemctl --user restart clawbridge
```

---

## ğŸ¯ Triggering

```bash
touch TRIGGERDIR/A
```

---

## â° Cron Jobs

Declare with `mode: cron` in the yaml â€“ no `script` needed. CLAWBRIDGE ghosts the trigger file completely, leaving it for the cron script to consume.

Add this snippet at the top of any cron script:

```bash
_TRIGGER="$HOME/souly9999/CLAWBRIDGE/TRIGGERDIR/C"
[ ! -f "$_TRIGGER" ] && exit 0
rm -f "$_TRIGGER"
```

No trigger file â†’ silent exit. Trigger file present â†’ consume and continue.

---

## ğŸ“Š Logs

```bash
tail -f ~/souly9999/CLAWBRIDGE/logs/CLAWBRIDGE.log
tail -f ~/souly9999/CLAWBRIDGE/logs/DROP.log
journalctl --user -u clawbridge -f
```
